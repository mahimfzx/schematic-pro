<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f0c29">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Schematic Pro Ultimate</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anek+Bangla:wght@300;400;600;800&family=Bricolage+Grotesque:opsz,wght@12..96,400;600;800&display=swap" rel="stylesheet">

    <style>
        /* =========================================
           COSMIC POP THEME VARIABLES
           ========================================= */
        :root {
            /* Cosmic Pop Light */
            --bg-body: #f3f4f7;
            --surface: #ffffff;
            --primary: #6c5ce7;
            --accent: #fd79a8;
            --grad-cosmic: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%);
            --grad-pop: linear-gradient(135deg, #FF3CAC 0%, #784BA0 50%, #2B86C5 100%);
            --grad-text: linear-gradient(90deg, #FF3CAC, #2B86C5);
            --text-main: #2d3436;
            --text-sub: #636e72;
            --border: #dfe6e9;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow-app: 0 10px 30px rgba(0,0,0,0.08);
            --radius: 20px;
            --nav-height: 70px;
        }

        [data-theme="dark"] {
            /* Cosmic Pop Dark */
            --bg-body: #0f0c29;
            --surface: #1b1b3a; /* Deep cosmic blue */
            --primary: #a29bfe;
            --accent: #ff7675;
            --grad-cosmic: linear-gradient(135deg, #302b63 0%, #24243e 100%);
            --grad-pop: linear-gradient(135deg, #f53844 0%, #42378f 100%);
            --grad-text: linear-gradient(90deg, #00f260, #0575E6);
            --text-main: #dfe6e9;
            --text-sub: #b2bec3;
            --border: #2d3436;
            --glass: rgba(27, 27, 58, 0.98);
            --shadow-app: 0 10px 40px rgba(0,0,0,0.4);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg-body);
            color: var(--text-main);
            font-family: 'Bricolage Grotesque', 'Anek Bangla', sans-serif;
            overflow: hidden; /* App style: no body scroll */
            height: 100vh;
            width: 100vw;
            transition: background 0.4s, color 0.4s;
            user-select: none;
        }

        /* App Container */
        #app-container {
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            max-width: 600px; /* Mobile View Limit */
            margin: 0 auto;
            background: var(--bg-body);
            box-shadow: 0 0 50px rgba(0,0,0,0.1);
        }

        /* =========================================
           HEADER SECTION (UPDATED)
           ========================================= */
        header {
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 2px 20px 0px 20px; /* Reduced Top Padding */
            z-index: 50;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 45px; /* Fixed height for top bar*/
            margin-bottom: 15px;
        }

        /* Creative Logo */
        .logo-area { display: flex; align-items: center; gap: 8px; }
        .logo-svg { width: 32px; height: 32px; fill: url(#logoGrad); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-3px); } 100% { transform: translateY(0px); } }

        .brand-title {
            font-size: 24px;
            font-weight: 800;
            background: var(--grad-pop);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: -0.5px;
        }

        /* Controls (Theme + Lang + Mini Search) */
        .controls { display: flex; gap: 10px; align-items: center; }
        .ctrl-btn {
            width: 38px; height: 38px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            color: var(--text-main);
            font-weight: 700;
            font-size: 14px;
            transition: transform 0.2s;
        }
        .ctrl-btn:active { transform: scale(0.9); }

        /* Mini Search Button (Hidden by default) */
        .mini-search-btn {
            display: none;
            width: 38px; height: 38px;
            border-radius: 50%;
            background: var(--surface);
            border: 1px solid var(--border);
            align-items: center; justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        
        /* Collapsible Area */
        #collapsibleArea {
            overflow: hidden;
            max-height: 300px; /* Approximate max height */
            opacity: 1;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Header Collapsed State */
        header.collapsed #collapsibleArea {
            max-height: 0;
            opacity: 0;
            margin-bottom: 0;
        }
        header.collapsed { padding-bottom: 0; }
        header.collapsed .mini-search-btn { display: flex; }

        /* Search Bar */
        .search-wrapper { 
            position: relative; 
            width: 100%; 
            margin-bottom: 10px;
            margin-top: 5px;
        }
        input#searchBox {
            width: 100%;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 15px;
            padding: 14px 20px 14px 45px;
            font-size: 16px;
            color: var(--text-main);
            font-family: inherit;
            transition: 0.3s;
        }
        input#searchBox:focus { outline: none; border-color: #6c5ce7; box-shadow: 0 0 0 4px rgba(108, 92, 231, 0.1); }
        .search-icon-svg { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); width: 20px; fill: var(--text-sub); }

        /* Marquee & Refresh */
        .marquee-box {
            background: var(--surface);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 5px;
            overflow: hidden;
            position: relative;
            white-space: nowrap;
        }
        .marquee-content {
            display: inline-block;
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            animation: marquee 15s linear infinite;
        }
        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .refresh-area { display: flex; justify-content: center; margin-bottom: 10px; }
        .refresh-btn {
            background: var(--surface); border: 1px solid var(--border);
            padding: 5px 15px; border-radius: 20px;
            display: flex; align-items: center; gap: 5px;
            font-size: 12px; font-weight: 700; color: var(--text-sub);
            cursor: pointer; transition: 0.3s;
        }
        .refresh-btn:active { transform: scale(0.95); background: var(--bg-body); }
        .spin-icon { width: 14px; height: 14px; fill: var(--text-sub); }
        .spinning { animation: spin 1s linear infinite; }

        /* Filters */
        .filters { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 5px; }
        .filters::-webkit-scrollbar { display: none; }
        .chip {
            background: var(--surface); border: 1px solid var(--border);
            color: var(--text-sub); padding: 6px 16px; border-radius: 20px;
            font-size: 13px; font-weight: 600; white-space: nowrap; transition: 0.3s;
        }
        .chip.active { background: var(--grad-cosmic); color: #fff; border-color: transparent; }

        /* Toggle Arrow Handle */
        .toggle-handle {
            position: absolute;
            bottom: -14px; left: 50%;
            transform: translateX(-50%);
            width: 40px; height: 14px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-top: none;
            border-bottom-left-radius: 10px;
            border-bottom-right-radius: 10px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            z-index: 40;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .handle-icon { width: 16px; height: 16px; fill: var(--text-sub); transition: transform 0.3s; }
        header.collapsed .handle-icon { transform: rotate(180deg); }

        /* =========================================
           SCROLLABLE CONTENT AREA
           ========================================= */
        #content-area {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 20px 20px 100px 20px; /* Padding bottom for nav bar */
            scroll-behavior: smooth;
        }

        /* List Items (Height Increased) */
        .list-item {
            background: var(--surface);
            margin-bottom: 12px;
            padding: 15px 10px; /* INCREASED HEIGHT */
            border-radius: 16px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 2px 4px 15px rgba(0,0,0,0.03);
            border: 1px solid var(--border);
            transition: 0.2s;
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .list-item:active { transform: scale(0.98); }
        .model-name { font-weight: 700; font-size: 17px; }
        .arrow-icon { width: 24px; height: 24px; fill: var(--text-sub); background: var(--bg-body); padding: 5px; border-radius: 50%; }

        /* Spinner */
        .spinner { width: 40px; height: 40px; border: 4px solid rgba(108, 92, 231, 0.2); border-top-color: #6c5ce7; border-radius: 50%; margin: 30px auto; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* =========================================
           TAB VIEWS & OTHERS (UNCHANGED)
           ========================================= */
        .tab-view { display: none; padding: 20px; text-align: center; animation: fadeIn 0.3s; }
        .tab-view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .share-card { background: var(--surface); border-radius: 20px; padding: 30px; border: 2px dashed var(--primary); position: relative; overflow: hidden; }
        .qr-img { width: 150px; height: 150px; margin: 0 auto 20px; display: block; border-radius: 10px; border: 1px solid var(--border); padding: 5px; background: white; }
        .btn-action { width: 100%; padding: 15px; border-radius: 15px; border: none; background: var(--grad-pop); color: white; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 5px 15px rgba(108, 92, 231, 0.3); display: flex; align-items: center; justify-content: center; gap: 10px; }
        
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 700; font-size: 14px; color: var(--text-sub); }
        .form-input { width: 100%; padding: 15px; border-radius: 12px; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); font-family: inherit; font-size: 15px; }
        .form-input:focus { outline: none; border-color: var(--primary); }
        textarea.form-input { height: 120px; resize: none; }

        .app-footer { margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border); text-align: center; }
        .dev-badge { background: var(--surface); display: inline-block; padding: 10px 25px; border-radius: 50px; border: 1px solid var(--border); box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .dev-text { font-size: 13px; color: var(--text-sub); margin-bottom: 4px; }
        .dev-name { font-weight: 800; color: var(--text-main); font-family: 'Rajdhani', sans-serif; letter-spacing: 0.5px; }
        .dev-link { color: #6c5ce7; font-weight: 700; text-decoration: none; font-size: 13px; }

        /* Bottom Nav */
        .bottom-nav { position: absolute; bottom: 0; left: 0; right: 0; height: var(--nav-height); background: var(--surface); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 100; border-top-left-radius: 25px; border-top-right-radius: 25px; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-sub); font-size: 12px; font-weight: 600; cursor: pointer; width: 60px; transition: 0.3s; }
        .nav-icon { width: 24px; height: 24px; fill: var(--text-sub); transition: 0.3s; }
        .nav-item.active { color: #6c5ce7; }
        .nav-item.active .nav-icon { fill: #6c5ce7; transform: translateY(-3px); filter: drop-shadow(0 4px 6px rgba(108, 92, 231, 0.4)); }

        /* Detail View */
        .detail-view { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--bg-body); z-index: 200; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column; }
        .detail-view.active { transform: translateX(0); }
        .dt-header { padding: 15px 20px; background: var(--surface); display: flex; align-items: center; gap: 15px; border-bottom: 1px solid var(--border); padding-top: max(15px, env(safe-area-inset-top)); }
        .dt-content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 80px; }
        .info-box { background: var(--surface); border-radius: 15px; padding: 20px; margin-bottom: 20px; border: 1px solid var(--border); border-left: 4px solid var(--primary); box-shadow: var(--shadow-app); }
        .info-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; border-bottom: 1px dashed var(--border); padding-bottom: 10px; }
        .info-label { font-weight: 800; font-size: 12px; color: var(--text-sub); text-transform: uppercase; }
        .info-icon { width: 20px; height: 20px; fill: var(--primary); }
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: 600; font-size: 14px; margin-top: 8px; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-dl { background: linear-gradient(to right, #ff416c, #ff4b2b); }
        .btn-view { background: linear-gradient(to right, #56ab2f, #a8e063); }
        .btn-full { background: var(--grad-cosmic); }
        .preview-area { display: none; margin-top: 15px; border-radius: 10px; overflow: hidden; border: 1px solid var(--border); background: white; }
        .preview-area iframe, .preview-area img { width: 100%; display: block; border: none; }
        .preview-area iframe { height: 350px; }

        /* PDF Overlay */
        .pdf-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 300; display: flex; flex-direction: column; transform: scale(0); transition: 0.3s; }
        .pdf-overlay.open { transform: scale(1); }
        .pdf-toolbar { height: 60px; background: #2d3436; color: white; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; padding-top: env(safe-area-inset-top); box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        .pdf-controls { display: flex; gap: 10px; }
        .zoom-btn { width: 30px; height: 30px; border-radius: 5px; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; font-weight: bold; }
        .zoom-btn:active { background: rgba(255,255,255,0.4); }
        .pdf-container { flex: 1; background: #525659; overflow: auto; position: relative; display: flex; align-items: flex-start; justify-content: center; }
        .pdf-wrapper { width: 100%; height: 100%; transition: transform 0.2s ease-out; transform-origin: top center; }
        .pdf-wrapper iframe { width: 100%; height: 100%; border: none; background: white; }

        /* SVG Gradients */
        svg { overflow: visible; }
    </style>
</head>
<body data-theme="dark">

    <div id="app-container">
        
        <header id="mainHeader">
            <svg width="0" height="0">
                <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#FF3CAC;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#2B86C5;stop-opacity:1" />
                </linearGradient>
            </svg>

            <div class="header-top">
                <div class="logo-area">
                    <svg class="logo-svg" viewBox="0 0 24 24"><path d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z"/></svg>
                    <div class="brand-title">Schematic</div>
                </div>
                <div class="controls">
                    <div class="mini-search-btn" onclick="toggleHeader()">
                        <svg style="width:18px; fill:var(--text-main)" viewBox="0 0 24 24"><path d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM11 18a7 7 0 1 1 7-7 7 7 0 0 1-7 7z"/></svg>
                    </div>
                    <div class="ctrl-btn" id="langBtn" onclick="toggleLang()">EN</div>
                    <div class="ctrl-btn" onclick="toggleTheme()" id="themeBtn">
                        <svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:var(--text-main)"><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path></svg>
                    </div>
                </div>
            </div>

            <div id="collapsibleArea">
                <div class="search-wrapper">
                    <svg class="search-icon-svg" viewBox="0 0 24 24"><path d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42zM11 18a7 7 0 1 1 7-7 7 7 0 0 1-7 7z"/></svg>
                    <input type="text" id="searchBox" placeholder="Search schematic...">
                </div>

                <div class="marquee-box">
                    <div class="marquee-content" id="marqueeText">
                        Assalamu Alaikum! Welcome to Schematic Pro. Disclaimer: Use these files for educational and repair purposes only.
                    </div>
                </div>

                <div class="refresh-area">
                    <div class="refresh-btn" onclick="forceRefresh()">
                        <svg class="spin-icon" id="spinIcon" viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                        <span data-lang="refresh">Refresh Data</span>
                    </div>
                </div>

                <div class="filters" id="filterContainer">
                    <div class="chip active" onclick="sortData('all', this)" data-lang="all">All Models</div>
                    <div class="chip" onclick="sortData('asc', this)">A-Z</div>
                    <div class="chip" onclick="sortData('desc', this)">Z-A</div>
                </div>
            </div>
            
            <div class="toggle-handle" onclick="toggleHeader()">
                <svg class="handle-icon" viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg>
            </div>
        </header>

        <div id="content-area">
            
            <div id="listView">
                <div class="spinner"></div>
            </div>
            
            <div class="app-footer" id="mainFooter">
                <div class="dev-badge">
                    <div class="dev-text">Developed by</div>
                    <div class="dev-name">Mahim Patwary</div>
                    <a href="mailto:mahimfzx@gmail.com" class="dev-link">mahimfzx@gmail.com</a>
                </div>
            </div>

            <div id="shareView" class="tab-view">
                <div class="share-card">
                    <h2 style="margin-bottom:15px; font-weight:800;" data-lang="shareTitle">Share with Friends</h2>
                    <img id="qrImage" class="qr-img" src="" alt="QR Code" />
                    <p style="margin-bottom:20px; font-size:13px; color:var(--text-sub);" data-lang="shareDesc">Scan or click below to share this app.</p>
                    <button class="btn-action" onclick="shareApp()">
                        <svg style="width:20px; fill:white" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                        <span data-lang="shareBtn">Share App</span>
                    </button>
                </div>
            </div>

            <div id="feedbackView" class="tab-view">
                <h2 style="margin-bottom:20px; font-weight:800;" data-lang="feedTitle">Feedback</h2>
                <div class="form-group">
                    <label class="form-label" data-lang="subject">Subject</label>
                    <input type="text" class="form-input" id="fbSubject" placeholder="Enter subject...">
                </div>
                <div class="form-group">
                    <label class="form-label" data-lang="message">Message</label>
                    <textarea class="form-input" id="fbMessage" placeholder="Write your problem or suggestion..."></textarea>
                </div>
                <button class="btn-action" onclick="sendFeedback()">
                    <svg style="width:20px; fill:white" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
                    <span data-lang="sendBtn">Send Email</span>
                </button>
            </div>

        </div>

        <div class="bottom-nav" style="position: fixed !important; bottom: 0; left: 0; right: 0; z-index: 9999 !important; background: var(--surface); display: flex; align-items: center; justify-content: space-around; height: 70px; border-top: 1px solid var(--border); box-shadow: 0 -5px 20px rgba(0,0,0,0.1);">

            <div class="nav-item active" onclick="switchTab('home', this)">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
                <span data-lang="navHome">Home</span>
            </div>
            <div class="nav-item" onclick="switchTab('share', this)">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                <span data-lang="navShare">Share</span>
            </div>
            <div class="nav-item" onclick="switchTab('feedback', this)">
                <svg class="nav-icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-7 12h-2v-2h2v2zm0-4h-2V6h2v4z"/></svg>
                <span data-lang="navFeed">Feedback</span>
            </div>
        </div>

    </div>

    <div id="detailView" class="detail-view">
        <div class="dt-header">
            <div onclick="closeDetails()" style="cursor:pointer; padding:5px;">
                <svg viewBox="0 0 24 24" style="width:28px; fill:var(--text-main)"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/></svg>
            </div>
            <div style="font-weight:700; font-size:18px;" id="dtTitle">Model Name</div>
        </div>
        <div class="dt-content" id="dtContent"></div>
    </div>

    <div id="pdfOverlay" class="pdf-overlay">
        <div class="pdf-toolbar">
            <span style="font-weight:600;">Schematic View</span>
            <div class="pdf-controls">
                <div class="zoom-btn" onclick="pdfZoom(0.2)">+</div>
                <div class="zoom-btn" onclick="pdfZoom(-0.2)">−</div>
                <div class="zoom-btn" onclick="pdfReset()" style="font-size:10px">RST</div>
                <button onclick="closeFullPdf()" style="background:none; border:none; color:white; font-size:24px; margin-left:10px;">✕</button>
            </div>
        </div>
        <div class="pdf-container">
            <div id="pdfWrapper" class="pdf-wrapper">
                <iframe id="fullPdfFrame" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        // CONFIG
        const API_URL = 'https://script.google.com/macros/s/AKfycby-Mj4FPLQaCtRBsAQ4vYgFnzZOqZ-E1prVqISq5FIclFqBwC2xsxOzLHD99wf0TGON/exec';
        
        // ICONS
        const ICONS = {
            pdf: '<svg class="info-icon" viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm10 5.5h1v-3h-1v3z"/></svg>',
            image: '<svg class="info-icon" viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>',
            text: '<svg class="info-icon" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>',
            download: '<svg style="width:16px; fill:white" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>',
            eye: '<svg style="width:16px; fill:white" viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>',
            full: '<svg style="width:16px; fill:white" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>'
        };

        // LANGUAGE DATA
        const dict = {
            en: {
                search: "Search schematic...",
                refresh: "Refresh Data",
                all: "All Models",
                navHome: "Home",
                navShare: "Share",
                navFeed: "Feedback",
                shareTitle: "Share with Friends",
                shareDesc: "Scan or click below to share this app.",
                shareBtn: "Share App",
                feedTitle: "Feedback",
                subject: "Subject",
                message: "Message",
                sendBtn: "Send Email",
                marquee: "Welcome to Schematic Pro. Disclaimer: Use these files for educational and repair purposes only."
            },
            bn: {
                search: "মডেল সার্চ করুন...",
                refresh: "রিফ্রেশ করুন",
                all: "সব মডেল",
                navHome: "হোম",
                navShare: "শেয়ার",
                navFeed: "ফিডব্যাক",
                shareTitle: "বন্ধুদের সাথে শেয়ার করুন",
                shareDesc: "স্ক্যান বা ক্লিক করে অ্যাপটি শেয়ার করুন।",
                shareBtn: "শেয়ার অ্যাপ",
                feedTitle: "মতামত দিন",
                subject: "বিষয়",
                message: "আপনার বার্তা",
                sendBtn: "ইমেইল পাঠান",
                marquee: "আসসালামু আলাইকুম! Schematic Pro তে স্বাগতম। ডিসক্লেইমার: এই ফাইলগুলো শুধুমাত্র শিক্ষামূলক এবং মেরামতের কাজের জন্য ব্যবহার করুন।"
            }
        };

        // STATE
        let allData = [];
        let currentData = [];
        let currentLang = localStorage.getItem('lang') || 'bn';
        let pdfScale = 1;

        // 1. INIT & LANGUAGE
        function init() {
            setLanguage(currentLang);
            loadData();
            generateQRCode();
            setupScrollListener();
        }

        function toggleLang() {
            currentLang = currentLang === 'en' ? 'bn' : 'en';
            localStorage.setItem('lang', currentLang);
            setLanguage(currentLang);
        }

        function setLanguage(lang) {
            document.getElementById('langBtn').innerText = lang.toUpperCase();
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if(dict[lang][key]) el.innerText = dict[lang][key];
            });
            document.getElementById('searchBox').placeholder = dict[lang].search;
            document.getElementById('fbSubject').placeholder = lang === 'bn' ? 'বিষয় লিখুন...' : 'Enter subject...';
            document.getElementById('fbMessage').placeholder = lang === 'bn' ? 'আপনার সমস্যা বা পরামর্শ লিখুন...' : 'Write your problem or suggestion...';
            document.getElementById('marqueeText').innerText = dict[lang].marquee;
        }

        // 2. THEME LOGIC
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('themeBtn');
            const isDark = body.getAttribute('data-theme') === 'dark';
            if (isDark) {
                body.removeAttribute('data-theme');
                btn.innerHTML = `<svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:var(--text-main)"><path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z"></path></svg>`;
            } else {
                body.setAttribute('data-theme', 'dark');
                btn.innerHTML = `<svg viewBox="0 0 24 24" style="width:20px; height:20px; fill:var(--text-main)"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.79 1.41-1.41-1.79-1.79-1.41 1.41zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>`;
            }
        }

        // 3. SCROLL & COLLAPSE LOGIC (NEW)
        function setupScrollListener() {
            const content = document.getElementById('content-area');
            const header = document.getElementById('mainHeader');
            
            content.addEventListener('scroll', () => {
                if (content.scrollTop > 30) {
                    if (!header.classList.contains('collapsed')) {
                        header.classList.add('collapsed');
                    }
                } else {
                    if (header.classList.contains('collapsed')) {
                        header.classList.remove('collapsed');
                    }
                }
            });
        }

        function toggleHeader() {
            const header = document.getElementById('mainHeader');
            header.classList.toggle('collapsed');
        }

        // 4. DATA & REFRESH
        async function loadData() {
            const cached = localStorage.getItem('schematicData');
            if (cached) {
                allData = JSON.parse(cached);
                currentData = allData;
                renderList(currentData);
            }
            try {
                const res = await fetch(API_URL);
                const newData = await res.json();
                if (JSON.stringify(newData) !== cached) {
                    localStorage.setItem('schematicData', JSON.stringify(newData));
                    allData = newData;
                    currentData = allData;
                    renderList(currentData);
                }
            } catch (e) { console.error(e); }
        }

        function forceRefresh() {
            document.getElementById('spinIcon').classList.add('spinning');
            localStorage.removeItem('schematicData');
            loadData().then(() => {
                setTimeout(() => document.getElementById('spinIcon').classList.remove('spinning'), 1000);
            });
        }

        function renderList(data) {
            const container = document.getElementById('listView');
            container.innerHTML = '';
            if (!data.length) {
                container.innerHTML = `<div style="text-align:center;padding:50px;color:var(--text-sub)">${currentLang==='bn'?'কোনো তথ্য পাওয়া যায়নি':'No data found'}</div>`;
                return;
            }
            const fragment = document.createDocumentFragment();
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="model-name">${item['Model Name'] || 'Unknown'}</div>
                    <svg class="arrow-icon" viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
                `;
                div.onclick = () => openDetails(item);
                fragment.appendChild(div);
            });
            container.appendChild(fragment);
        }

        // 5. FUNCTIONALITIES
        document.getElementById('searchBox').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase().trim();
            if(document.getElementById('listView').style.display === 'none') {
                document.querySelectorAll('.nav-item')[0].click();
            }
            currentData = allData.filter(item => {
                return Object.values(item).some(val => String(val).toLowerCase().includes(term));
            });
            renderList(currentData);
        });

        function switchTab(tab, el) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('listView').style.display = 'none';
            document.getElementById('mainFooter').style.display = 'none';
            document.querySelectorAll('.tab-view').forEach(v => v.classList.remove('active'));

            if (tab === 'home') {
                document.getElementById('listView').style.display = 'block';
                document.getElementById('mainFooter').style.display = 'block';
                document.getElementById('searchBox').value = '';
                currentData = allData;
                renderList(currentData);
                // Reset header on home
                document.getElementById('mainHeader').classList.remove('collapsed');
            } else if (tab === 'share') {
                document.getElementById('shareView').classList.add('active');
            } else if (tab === 'feedback') {
                document.getElementById('feedbackView').classList.add('active');
            }
        }

        function sortData(type, el) {
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            if(type === 'all') currentData = [...allData];
            else if (type === 'asc') currentData.sort((a,b)=>(a['Model Name']||'').localeCompare(b['Model Name']||''));
            else if (type === 'desc') currentData.sort((a,b)=>(b['Model Name']||'').localeCompare(a['Model Name']||''));
            renderList(currentData);
        }

        function sendFeedback() {
            const sub = document.getElementById('fbSubject').value;
            const msg = document.getElementById('fbMessage').value;
            window.location.href = `mailto:mahimfzx@gmail.com?subject=${encodeURIComponent(sub)}&body=${encodeURIComponent(msg)}`;
        }

        function generateQRCode() {
            const url = window.location.href;
            const qrApi = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(url)}`;
            document.getElementById('qrImage').src = qrApi;
        }

        function shareApp() {
            if (navigator.share) {
                navigator.share({ title: 'Schematic Pro', text: 'Check out this Schematic App!', url: window.location.href });
            } else {
                alert('Share URL copied!');
                navigator.clipboard.writeText(window.location.href);
            }
        }

        // 6. DETAILS & PDF
        function getDriveId(url) {
            if (!url || typeof url !== 'string') return null;
            const match = url.match(/[-\w]{25,}/);
            return match ? match[0] : null;
        }

        function openDetails(item) {
            const title = document.getElementById('dtTitle');
            const content = document.getElementById('dtContent');
            title.innerText = item['Model Name'];
            content.innerHTML = '';

            for (const key in item) {
                if (!item[key] || key === 'Model Name') continue;
                const value = item[key];
                const strValue = String(value || ""); 
                const cleanLabel = key.replace(/_pdf|_img/g, '').replace(/_/g, ' ');
                const driveId = getDriveId(strValue);
                let boxHTML = '';

                if (key.endsWith('_pdf')) {
                    let pdfSrc = strValue; 
                    if (driveId) pdfSrc = `https://drive.google.com/file/d/${driveId}/preview`;
                    boxHTML = `
                        <div class="info-box">
                            <div class="info-header">${ICONS.pdf} <span class="info-label">${cleanLabel}</span></div>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                                <a href="${strValue}" target="_blank" class="btn btn-dl">${ICONS.download} Download</a>
                                <button onclick="togglePreview('p-${key}')" class="btn btn-view">${ICONS.eye} Preview</button>
                            </div>
                            <button onclick="openFullPdf('${pdfSrc}')" class="btn btn-full">${ICONS.full} Full Screen Schematic</button>
                            <div id="p-${key}" class="preview-area"><iframe loading="lazy" src="${pdfSrc}" allow="autoplay"></iframe></div>
                        </div>`;
                }
                else if (key.endsWith('_img')) {
                    let imgSrc = strValue;
                    if (driveId) imgSrc = `https://drive.google.com/uc?export=view&id=${driveId}`;
                    boxHTML = `
                        <div class="info-box">
                            <div class="info-header">${ICONS.image} <span class="info-label">${cleanLabel}</span></div>
                            <button onclick="togglePreview('i-${key}')" class="btn btn-view">${ICONS.eye} View Image</button>
                            <div id="i-${key}" class="preview-area"><img loading="lazy" src="${imgSrc}" alt="Preview"></div>
                        </div>`;
                } else {
                    boxHTML = `
                        <div class="info-box">
                            <div class="info-header">${ICONS.text} <span class="info-label">${cleanLabel}</span></div>
                            <div style="font-size:15px; line-height:1.6;">${value}</div>
                        </div>`;
                }
                content.innerHTML += boxHTML;
            }
            document.getElementById('detailView').classList.add('active');
        }

        function closeDetails() { document.getElementById('detailView').classList.remove('active'); }
        function togglePreview(id) {
            const el = document.getElementById(id);
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        }

        function openFullPdf(url) {
            document.getElementById('fullPdfFrame').src = url;
            document.getElementById('pdfOverlay').classList.add('open');
            pdfReset();
        }
        function closeFullPdf() {
            document.getElementById('pdfOverlay').classList.remove('open');
            document.getElementById('fullPdfFrame').src = "";
        }
        function pdfZoom(amount) {
            pdfScale += amount;
            if (pdfScale < 0.5) pdfScale = 0.5;
            if (pdfScale > 3) pdfScale = 3;
            updatePdfTransform();
        }
        function pdfReset() { pdfScale = 1; updatePdfTransform(); }
        function updatePdfTransform() {
            const wrapper = document.getElementById('pdfWrapper');
            wrapper.style.transform = `scale(${pdfScale})`;
            if(pdfScale > 1) { wrapper.style.width = `${100 * pdfScale}%`; wrapper.style.height = `${100 * pdfScale}%`; }
            else { wrapper.style.width = '100%'; wrapper.style.height = '100%'; }
        }

        init();
    </script>
</body>
</html>
